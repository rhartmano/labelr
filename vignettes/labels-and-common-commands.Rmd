---
title: "Using Labels with Popular R Commands"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using Labels with Popular R Commands}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "### >"
)
```
## What Are Labels for?
labelr allows you to label Base R data.frames and then use those labels in a few
different ways, according to your needs. These include: producing basic label 
look-up tables, replacing a variable's values with its corresponding value labels 
(be careful with this!), augmenting a data.frame by providing a labels-as-values 
column for each labeled variables, and temporarily "turning on" variable name or
value labels in the context of other R commands from Base R or user-contributed 
packages. Here, we will briefly illustrate a few examples of the latter.
<br>

First, note that shorthand **alias** versions are available for all of the 
labelr functions demonstrated below (see vignette **Aliases for Common labelr 
Functions**). A complete listing of alias functions is presented at the end of 
this vignette.

## First Things First - Let's Label Our Data Frame
We'll use the popular Motor Trend Cars (mtcars) data.frame. We'll start by loading
labelr, copying mtcars to new data.frame called df, adding variable name labels, 
then adding variable value labels. Then we'll show a few ways to use labels (mostly
value labels) with some non-labelr R commands (mostly Base R).

## Load labelr
Let's load labelr. 

```{r setup}
library(labelr)
```
## Copy mtcars
Create df (a copy of mtcars):
```{r}
df <- mtcars
```

## Add a FRAME Label
Let's add a "frame label," which describes the data.frame overall.
```{r}
mt2 <- add_frame_lab(mtcars, frame.lab = "Data extracted from the 1974 Motor
Trend US magazine, comprising fuel consumption and 10 aspects of automobile
design and performance for 32 automobiles (1973–74 models). Source: Henderson
and Velleman (1981), Building multiple regression models interactively.
 Biometrics, 37, 391–411.")
```
Let's see what this did.
```{r}
attr(mt2, "frame.lab") # check for attribute

get_frame_lab(mt2) # return frame.lab alongside data.frame name as a data.frame

get_frame_lab(mt2)$frame.lab
```

## Create and Assign NAME Labels
Now, we'll create **name** labels.
```{r}
names_labs_vec <- c(
  "mpg" = "Miles/(US) gallon",
  "cyl" = "Number of cylinders",
  "disp" = "Displacement (cu.in.)",
  "hp" = "Gross horsepower",
  "drat" = "Rear axle ratio",
  "wt" = "Weight (1000 lbs)",
  "qsec" = "1/4 mile time",
  "vs" = "Engine (0 = V-shaped, 1 = straight)",
  "am" = "Transmission (0 = automatic, 1 = manual)",
  "gear" = "Number of forward gears",
  "carb" = "Number of carburetors"
)
```

Let's assign these name labels to df, using `add_name_labs()`.
```{r}
df <- add_name_labs(df,
  name.labs = names_labs_vec
)
```

Note: A shorter alias for `add_name_labs` is `anl`.

## Assign VALUE Labels
Now, we will assign **VALUE** labels to select variables.

```{r}
df <- df |>
  add_val1(am,
    vals = c(0, 1),
    labs = c("automatic", "manual")
  ) |>
  add_val1(cyl,
    vals = c(4, 6, 8),
    labs = c("four-cyl", "six-cyl", "eight-cyl")
  ) |>
  add_val1(gear,
    vals = 3:5,
    labs = c("3-speed", "4-speed", "5-speed")
  ) |>
  add_val1(carb,
    vals = c(1, 2, 3, 4, 6, 8),
    labs = c(
      "1-carb", "2-carbs", "3-carbs",
      "4-carbs", "6-carbs", "8-carbs"
    )
  )
```
Note: A (slightly!) shorter alias for `add_val1` is `avl1`.
Note: For an alternative approach, see `add_val_labs` (alias: `avl`).

## Where Does This Leave Us?

mtcars remains value label-less:
```{r}
get_val_labs(mtcars)
```

Not so for df. It now has value labels:
```{r}
get_val_labs(df)
```

Note: A shorter alias for `get_val_labs` is `gvl`.


## Use the Labels
Now, we can use the value or name labels when and if it illuminates things. There 
is a trade-off between the plain language interpretability of labels and the 
concision of values. Many label use cases that are possible in principle will be
dubious in practice. This will be a matter of judgment and personal taste.

Note: If typing `use_val_labs` becomes tedious, a shorter alias called 
`uvl` is available.

### Grouped Statistics with `collapse::qsu()`
`use_val_labs` converts labeled variables to character variables, which
gives us more interpretable (albeit more verbose) output. We can combine this 
functionality with the `qsu()` function from the collapse package to calculate
grouped statistics, where the value labels define the groups. Note how 0 and 1
become "automatic" and "manual" when df is wrapped in `use_val_labs()`.

```{r}
# with labels "off" (i.e., using regular values of "am" as by var)
by_trans_val <- collapse::qsu(df, cols = c("mpg", "disp"), by = ~am)
by_trans_val

# with labels "on" (i.e., using labels, thanks to `use_val_labs()`)
by_trans_lab <- collapse::qsu(use_val_labs(df), cols = c("mpg", "disp"), by = ~am)
by_trans_lab
```
### `xtabs()` 
Likewise, `use_val_labs` gives us more interpretable output in this application 
of `xtabs()`

```{r}
xtabs(~am, data = df)

xtabs(~am, data = use_val_labs(df))
```
See also `tabl()`.

### `t.test()`
`use_val_labs` converts labeled variables to character variables, which
gives us more interpretable output in this application of `t.test()` if we focus
on the **"mean in..."** text of the output.

```{r}
t.test(mpg ~ am, data = df)

t.test(mpg ~ am, data = use_val_labs(df)) # value labels "on"; same as `use_val_labs`
```

### `lm()`
`use_val_labs` converts labeled variables to character variables, then 
`lm()` converts them to factors on the fly.

```{r}
# this
lm(mpg ~ am + cyl + gear, data = df) # equivalent to mtcars, labels "off"

# is the same as this:
lm(mpg ~ am + cyl + gear, data = mtcars) # mtcars is same as our df

# if we were to coerce our predictors to factors, we would get this
lm(mpg ~ as.factor(am) + as.factor(cyl) + as.factor(gear), data = df)

# value labels "on" turns these to character; `lm()` treats them as factor
# note that the reference level changes in the case of variable "cyl"
lm(mpg ~ am + cyl + gear, data = use_val_labs(df)) # `uvl()` can be used instead
```

### collapse package's `qsu()` command and `use_name_labs()`
What about variable **NAME** labels? 
<br>
<br>
These tend to be rather verbose, so, worthwhile applications may be more limited.
<br>
<br>
But here is one that could be helpful, thanks to an assist from the collapse package.
<br>
<br>
<br>

`collapse::qsu()` (from collapse package) with df vs. df wrapped in `use_name_labs()`

```{r}
collapse::qsu(df)

collapse::qsu(use_name_labs(df)) # the alias `unl()` can be used instead of `use_name_labs()`
```

## Alias functions
As you familiarize yourself with core labelr functions, you may find it convenient
to reduce typing by leveraging shorter aliases for these functions. 

A companion to this vignette repeats the same calls, substituting the shorter alias
function analogues for the functions we just demonstrated. See vignette 
**Aliases for Common labelr Functions**. 

By way of preview, the available alias functions are as follows:

* the alias for `add_val_labs` is `avl`

* the alias for `get_val_labs` is `gvl` 

* the alias for `drop_val_labs` is `dvl` 

* the alias for `add_val1` is `avl1` 

* the alias for `drop_val1` is `dvl1` 

* the alias for `add_quant_labs` is `aql` 

* the alias for `add_quant1` is `aq1` 

* the alias for `add_m1_lab` is `am1l` 

* the alias for `use_val_labs` is `uvl`

* the alias for `with_val_labs` is `wvl`

* the alias for `add_name_labs` is  `anl` 

* the alias for `get_name_labs` is `gnl`

* the alias for `drop_name_labs` is `dnl` 

* the alias for `use_name_labs` is `unl` 

* the alias for `use_var_names` is `uvn` 

* the alias for `with_name_labs` is `wnl`

* the alias for `with_both_labs` is `wbl`

* the alias for `add_frame_lab` is `afl`

* the alias for `get_frame_lab` is `gfl`

* the alias for `drop_frame_lab` is `dfl`
