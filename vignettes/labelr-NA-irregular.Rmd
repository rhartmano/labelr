---
title: "Labelr, NA Values, and Other Irregular Values"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Labelr, NA Values, and Other Irregular Values}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "### >"
)
```
First, let's load labelr.
```{r setup}
library(labelr)
```
## Overview
labelr is no fan of NA values or other "irregular" values, which are defined as
infinite values, not-a-number values, and character values that look like them
(e.g., "NAN", "INF", "inf", "Na"). When value-labeling a column / variable, 
such values are automatically given the catch-all label "NA." You do not need 
(and should not try) to specify this yourself, and you should not try to over-ride
labelr on this. If you want to use labelr AND you present with these sorts of
values, your options are to accept the default "NA" label or convert these
values to something else before labeling. The reasoning is that value labels are
rarely appropriate for the types of variables and scenarios where you absolutely
need to preserve the nuances of exotic values like -Inf and NaN. If you are the
edge case, some elbow grease and creativity will be required.

## Our Data
With that said, let's see how labelr handles this, with an assist from our old
friend mtcars (packaged with R's base distribution).

First, let's assign mtcars to a new data.frame object that we will besmirch.
```{r}
mtbad <- mtcars
```

Let's get on with the besmirching.
```{r}
mtbad[1, 1:11] <- NA
rownames(mtbad)[1] <- "Missing Car"
mtbad[2, "am"] <- Inf
mtbad[3, "gear"] <- -Inf
mtbad[5, "carb"] <- NaN
mtbad[2, "mpg"] <- Inf
mtbad[3, "mpg"] <- NaN

# add a character variable, for demonstration purposes
# if it makes you feel better, you can pretend these are Consumer Reports or
# ...JD Power ratings or something
set.seed(9202) # for reproducibility
mtbad$grade <- sample(c("A", "B", "C"), nrow(mtbad), replace = TRUE)
mtbad[4, "grade"] <- NA
mtbad[5, "grade"] <- "NA"
mtbad[6, "grade"] <- "Inf"

# see where this leaves us
head(mtbad)

sapply(mtbad, class)
```
Now, let's add value labels to this unruly data.frame. Note that `add_val1` 
automatically detects and handles irregular values and gives us a lot of 
visibility into its value-labeling actions.

```{r}
mtlabs <- mtbad |>
  add_val1(grade,
    vals = c("A", "B", "C"),
    labs = c("Gold", "Silver", "Bronze")
  ) |>
  add_val1(am,
    vals = c(0, 1),
    labs = c("auto", "stick")
  ) |>
  add_val1(carb,
    vals = c(1, 2, 3, 4, 6, 8), # not the most inspired use of labels
    labs = c(
      "1c", "2c", "3c",
      "4c", "6c", "8c"
    )
  ) |>
  add_val1(gear,
    vals = 3:5, # again, not the most compelling use case
    labs = c(
      "3-speed",
      "4-speed",
      "5-speed"
    )
  ) |>
  add_quant1(mpg, qtiles = 4) # add quartile-based value labels
```

## Let's See What This Did
### `use_val_labs()` view
```{r}
get_val_labs(mtlabs, "am") # NA values were detected and dealt with
```
Streamline the data.frame, while preserving labels.
```{r}
mtless <- sselect(mtlabs, mpg, cyl, am, gear, carb, grade)

head(mtless, 5)

head(mtless, 5) # note that the irregular values are still here
```

Note how all irregular values are coerced to "NA" when we substitute labels
for values with `use_val_labs()`.

```{r}
head(use_val_labs(mtless), 5) # but they all go to NA if we `use_val_labs`
```

### `add_lab_cols()` view
```{r}
mtlabs_plus <- add_lab_cols(mtlabs, c("mpg", "am")) # this creates and adds "am_lab" col
mtlabs_plus <- sselect(mtlabs_plus, mpg, mpg_lab, am, am_lab) # let's select down to these two

head(mtlabs_plus) # here's where we landed
```

